+++
mt_entry_id = 460
date = "2009-10-24T16:13:32+09:00"
title = "Re: [Perl]MT形式のエクスポート用に出力をエスケープする"
categories = []

+++

<a href="http://d.hatena.ne.jp/a666666/20091022/1256213712">MT形式のエクスポート用に出力をエスケープする - 刺身☆ブーメランのはてなダイアリー</a>

そうか。MTのエクスポート形式って業界標準なのか。。。

エスケープ結果を復元するコードが無かったので自分で書こうとしたが、もとのコードだとエスケープ後のデリミタと同じパターン(-----&lt;&gt;など)が元の文字列に存在した時に、正確に復元できないという問題に気づいたが、あきらめて風呂に入っているうちに解決策を思いついた。
文字列中のすべての「-」のみの行を３倍とかに変更してしまえば、安全にエスケープでき、かつラウンドトリップ可能となるはずです。<q>3倍なのは本来のデリミタ( '-' x 5 || '-' x 8 )と重複しないためで、彗星と直接の関係ありません。</q>

<script src="http://gist.github.com/217424.js"></script>

実際には、後方互換性が必要になる(このエスケープ形式に対応していないインポーターでも違和感無く読み込めるのが理想)ので、実戦投入は無理でしょう。
元記事のほうでは、HTML表示した場合に見た目変化が無いように空タグっぽい&lt;&gt;を末尾に追加したのだと思うのですが、MTなんかでは最終的な出力先がHTMLとは限らないので、良く無い事が起こりそうな気もします。デリミタと重複する行の末尾にスペースを一個追加してしまう、というあたりが落としどころになるのでしょうか。

