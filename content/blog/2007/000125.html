+++
mt_entry_id = 125
date = "2007-06-15T01:20:55+09:00"
title = "writing plugins for mt4: transformer"
categories = []

+++



MT4での新しいtransformerに挑戦してみました。
DOMライクなインターフェイスが提供され、管理画面の特定の位置にコードを挿入することが非常に容易になりました。

まず、DOMスタイルのtransformerは、PerlオブジェクトのMT::Template::Nodeに対して適用されます。そのため、プラグイン作成者が自分のコードを管理画面に挿入する場合、事前にコードをMT::Template::Nodeオブジェクトとして作成しておく必要があります。
MT::Template::Nodeオブジェクトというのは、MTのテンプレートが再構築される際に、個々のテンプレートタグ一つ一つの単位に分解された結果を収納するオブジェクトです。
といっても、身構えるほどのものではありません。実体は、単純な配列リファレンスです。以下の要素からなります。

<ol start="0">
	<li>タグ名の文字列。テキスト要素の場合は「TEXT」</li>
	<li>タグのアトリビュートのハッシュリファレンス。テキスト要素の場合は文字列</li>
	<li>コンパイルされた(MT::Template::Nodeに分解された)子要素の配列リファレンス</li>
	<li>子要素のテキスト</li>
	<li>アトリビュートの一覧。グローバルフィルタの適用のために内部的に利用・・・かな</li>
	<li>親要素へのリファレンス</li>
</ol>

テキスト要素か、MTのテンプレートタグかで動作が変わってきます。最初の要素が'TEXT'の場合は、単なる文字列として扱われます。

さて、早速新しいNodeを作ってみます。
MT::Templateクラスの、createElementメソッドを使います。

<pre class="code">my $new_node = $tmpl-&gt;createElement('TEXT', '&lt;b&gt;hello transformer?&lt;/b&gt;');</pre>

第一引数は、タグ名、第二引数はタグのアトリビュートです。
今回は、タグではない要素を追加するため、第一引数'TEXT'と指定、第二引数には直接文字列を指定しました。MTタグのノードを作成する場合には、第二引数にアトリビュートのハッシュリファレンスを指定します。
