+++
mt_entry_id = 95
date = "2007-04-05T00:34:57+09:00"
title = "Plagger::Plugin::Widget::Tumblr"
categories = []

+++

とりあえず作ってみました。
javascriptを起動するリンクが含まれているとGmailでリンクが削除されてしまうようなので、とりあえずjavascript無しです。
結果として、現状は範囲選択などは無視した動作となります。<!--more--><pre class="code">
package Plagger::Plugin::Widget::Tumblr;
use strict;
use base qw( Plagger::Plugin );
 
use HTML::Entities;
use URI;
use Encode;
 
sub register {
    my($self, $context) = @_;
    $context-&gt;register_hook(
        $self,
        'publish.entry.fixup' =&gt; \&amp;add,
    );
}
 
sub add {
    my($self, $context, $args) = @_;
    $args-&gt;{entry}-&gt;add_widget($self);
}
 
sub html {
    my($self, $entry) = @_;
    my $uri = URI-&gt;new('http://www.tumblr.net/share');
 
    $uri-&gt;query_form({
        v =&gt; '2',
        u =&gt; $entry-&gt;permalink,
        t =&gt; Encode::encode('utf-8', $entry-&gt;title),
    });
    my $url = HTML::Entities::encode($uri-&gt;as_string);
    return qq(&lt;a href=&quot;$url&quot;&gt;Tumblr&lt;/a&gt;);
}
 
1;
</pre>