+++
mt_entry_id = 251
date = "2007-10-17T11:11:45+09:00"
title = "OpenIDでログインできない問題をFoafファイルの設置によって回避する"
categories = []

+++

独自ドメインでサイトを作っていると、自分のサイトのURLをOpenIDとして使いたくなりますよね。
だがしかーし!
OpenIDとして利用するサイトの文字コードがeuc-jpやShiftJISの場合に、そのOpenIDを使ってMT4にサインインしようとするとエラーが発生する、という問題があります。これを回避する方法をメモしておきます。

まず、エラーが発生する条件は以下の通りです。

・MTで構築したブログのサイトURLを、OpenIDとして利用する
・そのブログの文字コードがUTF8ではない
・サインイン先のシステムがMT4である

以上の条件を満たしている

結論から言うと、エラーが出る原因はperlのXML::XPathモジュールがeuc-jpとShiftJISに対応していないためです。

MT4は、コメントの投稿を受け付ける場合に、コメントの投稿者がOpenIDでサインインを行うと、サインインの成功後にニックネームの取得を試みます。
このとき、MT4はニックネームの取得を以下の優先順位でトライします。
・OpenIDのURLから取得可能なメタ情報に含まれているFOAFファイル
・OpenIDのURLから取得可能なメタ情報に含まれているAtomフィード
・認証時のユーザー名
OpenIDのIDで指定されたサイトから、HEAD内のメタ情報を取ってくるわけですが、このときに利用しているXML::Xpath(XML::Parser)には古くからあるバグのようで
<!--more-->test